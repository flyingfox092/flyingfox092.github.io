<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  
  
  <title>解析命令行参数 | 江城子同学</title>
  
  <meta name="author" content="flyingfox" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="system programming" />
  
  <meta name="description" content="主要介绍解析命令行参数的两个函数：getopt()，getopt_long()">
<meta property="og:type" content="article">
<meta property="og:title" content="解析命令行参数">
<meta property="og:url" content="http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="江城子同学">
<meta property="og:description" content="主要介绍解析命令行参数的两个函数：getopt()，getopt_long()">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/images/thumbnail/getopt.png">
<meta property="article:published_time" content="2023-08-17T02:49:50.000Z">
<meta property="article:modified_time" content="2023-08-21T10:18:02.156Z">
<meta property="article:author" content="flyingfox">
<meta property="article:tag" content="system programming">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/images/thumbnail/getopt.png">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
    <link rel="stylesheet" href="/vendors/aplayer@1.10.1/dist/APlayer.min.css"></script>
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
    
  </style>
  
<meta name="generator" content="Hexo 6.3.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                    
                                        
                                            <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                        
                                    
                                        
                                            <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                        
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">江城子同学</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>江城子同学</h2> <br />
                        <span>十年饮冰，难凉热血</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">解析命令行参数</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2023-08-17T02:49:50.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2023-08-17</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">flyingfox</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~11.65K
                        
                        字
                    </li>
                
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1692613082156"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
                <div class="kratos-post-inner-toc toc-div-class" >
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#man%E6%89%8B%E5%86%8C"><span class="toc-number">1.</span> <span class="toc-text">man手册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getopt-3"><span class="toc-number">2.</span> <span class="toc-text">getopt(3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getopt-long-3"><span class="toc-number">3.</span> <span class="toc-text">getopt_long(3)</span></a></li></ol>
                </div>
            
            <hr />
            <div itemprop="articleBody"><p>主要介绍解析命令行参数的两个函数：getopt()，getopt_long()</p>
<span id="more"></span>

<p>注：标题中显示的函数数字表示该函数在man手册中所在章节（第2章的是系统调用函数，第3章的是标准函数）</p>
<h3 id="man手册"><a href="#man手册" class="headerlink" title="man手册"></a>man手册</h3><blockquote>
<p>  <em><strong>NAME</strong></em></p>
<p>  ​       <em>getopt, getopt_long -</em> <em>Parse command-line options</em></p>
<p>  <em><strong>SYNOPSIS</strong></em></p>
<p>  ​       <em>#include &lt;unistd.h&gt;</em></p>
<p>  ​       <em>int getopt(int argc, char * const argv[], const char *optstring);</em></p>
<p>  ​       <em>extern char *optarg;</em></p>
<p>  ​       <em>extern int optind, opterr, optopt;</em></p>
<p>  ​       <em>#include &lt;getopt.h&gt;</em></p>
<p>  ​       <em>int getopt_long(int argc, char * const argv[],</em> <em>const char *optstring,</em> <em>const struct option *longopts, int *longindex);</em></p>
<p>  ​       <em>int getopt_long_only(int argc, char * const argv[],</em> <em>const char *optstring,</em> <em>const struct option *longopts, int *longindex);</em></p>
<p>  <em><strong>DESCRIPTION</strong></em></p>
<p>  <em>The  getopt()  function parses the command-line arguments.  Its arguments argc and argv are the argument count and array as passed to the main() function on program invocation.  An element of argv that starts  with  ‘-‘ (and is not exactly “-“ or “–”) is an option element.  The characters of this element (aside from the initial ‘-‘) are option  characters.   <u>If  getopt()  is  called  repeatedly,  it returns successively each of the option characters from each of the option elements.</u></em></p>
<p>  <em><u>The variable optind is the index of the next element to be processed in argv.</u>  The system initializes this value to 1.  The caller can reset it to 1 to restart scanning of the same argv, or when scanning a new argument vector.</em></p>
<p>  <em>If getopt() finds another option character, it returns that character, updating the external variable optind and a static variable nextchar so that the next call to getopt() can resume the scan with  the following option character or argv-element.</em></p>
<p>  <u><em>If there are no more option characters, getopt() returns -1.  Then optind is the index in argv of the first argv-element that is not an option.</em></u></p>
<p>  <em>optstring is a string containing the legitimate option characters.  If such a character  is  followed by  a  colon,  the option requires an argument, so getopt() places a pointer to the following text in the same argv-element, or the text of the following argv-element, in  optarg.   Two  colons  mean  an option takes an optional arg; if there is text in the current argv-element (i.e., in the same word as the option name itself, for example, “-oarg”), then it is returned in optarg, otherwise optarg is set to  zero.   This is a GNU extension.  If optstring contains W followed by a semicolon, then -W foo is treated as the long option –foo.  (The -W option is reserved by POSIX.2  for  implementation  extensions.)  This behavior is a GNU extension, not available with libraries before glibc 2.</em></p>
<p>  <em>By default, getopt() permutes the contents of argv as it scans, so that eventually all the nonoptions are at the end.  Two other modes are also implemented.  If the first character of optstring is ‘+’ or the  environment variable POSIXLY_CORRECT is set, then option processing stops as soon as a nonoption argument is encountered.  If the first character of optstring is ‘-‘, then each  nonoption  argv-element is handled as if it were the argument of an option with character code 1.  (This is used by programs that were written to expect options and other argv-elements in any order and  that  care  about the  ordering  of the two.)  The special argument “–” forces an end of option-scanning regardless of the scanning mode.</em></p>
<p>  <em>If getopt() does not recognize an option character, it prints an error message to stderr, stores  the character  in  optopt, and returns ‘?’.  The calling program may prevent the error message by setting opterr to 0.</em></p>
<p>  <em>If getopt() finds an option character in argv that was not included in optstring, or if it detects  a missing  option  argument,  it returns ‘?’ and sets the external variable optopt to the actual option character.  If the first character (following any optional ‘+’ or ‘-‘ described above)  of  optstring is a colon (‘:’), then getopt() returns ‘:’ instead of ‘?’ to indicate a missing option argument.  If an error was detected, and the first character of optstring is not a colon, and the external variable opterr is nonzero (which is the default), getopt() prints an error message.</em></p>
<p>  ​    <em><strong>getopt_long() and getopt_long_only()</strong></em></p>
<p>  <em>The getopt_long() function works like getopt() except that it also accepts long options, started with two dashes.  (If the program accepts only long options, then optstring  should  be  specified  as  an empty  string (“”), not NULL.)  Long option names may be abbreviated if the abbreviation is unique or is an exact match for some defined option.   A  long  option  may  take  a  parameter,  of  the  form –arg&#x3D;param or –arg param.</em></p>
<p>  <em>longopts is a pointer to the first element of an array of struct option declared in &lt;getopt.h&gt; as</em></p>
<p>  ​           <em>struct option {</em></p>
<p>   ​               <em>const char *name;</em></p>
<p>  ​               <em>int         has_arg;</em></p>
<p>  ​               <em>int        *flag;</em></p>
<p>  ​               <em>int         val;</em></p>
<p>  ​           <em>};</em></p>
<p>  <em>The meanings of the different fields are:</em></p>
<p>  ​       <em>name   is the name of the long option.</em></p>
<p>  ​       <em>has_arg</em>   <em>is:  <strong>no_argument</strong>  (or  0) if the option does not take an argument; <strong>required_argument</strong> (or 1) if the option requires an argument; or <strong>optional_argument</strong> (or 2) if the option takes  an  optional argument.</em></p>
<p>  ​       <em>flag</em>   <em>specifies  how  results  are  returned for a long option.  If flag is NULL, then getopt_long() returns val.  (For example, the calling program may set val to  the  equivalent  short  option character.)  Otherwise, getopt_long() returns 0, and flag points to a variable which is set to val if the option is found, but left unchanged if the option is not found.</em></p>
<p>  ​       <em>val</em>    <em>is the value to return, or to load into the variable pointed to by flag.</em></p>
<p>  ​       <em>The last element of the array has to be filled with zeros.</em></p>
<p>  ​       <em>If longindex is not NULL, it points to a variable which is set to the index of the long option  relative to longopts.</em></p>
<p>  <em>getopt_long_only()  is like getopt_long(), but ‘-‘ as well as “–” can indicate a long option.  If an option that starts with ‘-‘ (not “–”) doesn’t match a long option, but does match a short option, it is parsed as a short option instead.</em></p>
<p>  <em><strong>RETURN VALUE</strong></em></p>
<p>  <u><em>If an option was successfully found, then getopt() returns the option character.  If all command-line options have been parsed, then getopt() returns -1.  If getopt() encounters an option character  that was  not  in  optstring, then ‘?’ is returned.  If getopt() encounters an option with a missing argument, then the return value depends on the first character in optstring: if it is ‘:’,  then  ‘:’  is returned; otherwise ‘?’ is returned.</em></u></p>
<p>  <em>getopt_long()  and  getopt_long_only() also return the option character when a short option is recognized.  For a long option, they return val if flag is NULL, and 0 otherwise.  Error  and  -1  returns are the same as for getopt(), plus ‘?’ for an ambiguous match or an extraneous parameter.</em></p>
</blockquote>
<h3 id="getopt-3"><a href="#getopt-3" class="headerlink" title="getopt(3)"></a>getopt(3)</h3><p>getopt() 函数用于解析命令行参数并返回对应的选项和参数。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getopt</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *<span class="type">const</span> argv[], <span class="type">const</span> <span class="type">char</span> *optstring)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> *optarg;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> optind, opterr, optopt;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><p><code>argc</code>：命令行参数个数，包括程序名本身。</p>
</li>
<li><p><code>argv</code>：指向命令行参数字符串数组的指针，其中包括程序名和各个参数。</p>
</li>
<li><p><code>optstring</code>：包含所有有效选项的字符串，表示程序所支持的命令行选项。<code>optstring</code>中的每个字符表示一个选项：</p>
</li>
<li><ul>
<li>大写字母表示可以带参数的选项；</li>
<li>小写字母表示不带参数的选项；</li>
<li>冒号（:）表示该选项必须带一个参数；</li>
</ul>
</li>
<li><p><code>optarg</code>：指向当前<strong>选项参数</strong>的指针。当 getopt() 解析到带有参数的选项时，可以通过访问 <code>optarg</code> 来获取该参数的值。</p>
</li>
<li><p><code>optind</code>：表示下一个要处理的参数索引。初始值为 1，每次调用 getopt() 后会自动更新，程序名、选项及其参数占据前几个位置，之后才是剩余参数。</p>
</li>
<li><p><code>opterr</code>：控制是否显示错误信息。如果设置为 0，getopt() 函数将不会打印错误信息到标准错误流（stderr）；如果设置为非零值，getopt() 函数将会打印错误信息到 stderr。</p>
</li>
<li><p><code>optopt</code>：用于保存无效选项字符（即不在 <code>optstring</code> 中的字符），以便在需要时进行处理。</p>
</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>如果找到合法选项，则返回选项的ASCII码。</li>
<li>如果所有的命令行选项都解析完毕，则返回-1。</li>
<li>如果遇到非法选项字符，则返回<code>?</code>，并将 <code>optopt</code> 变量设为非法选项字符的ASCII码。</li>
</ul>
<p>注意事项：</p>
<ol>
<li>当 getopt() 函数返回一个选项代码时，全局变量 <code>optarg</code> 将指向选项的参数，全局变量 <code>optind</code> 将指向下一个待处理的命令行参数的位置。</li>
<li>注意区分以下概念：选项、参数、选项参数、非选项参数。</li>
</ol>
<p>举个栗子：</p>
<p>task：以指定格式显示当前系统时间。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mydate.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  -y: year</span></span><br><span class="line"><span class="comment"> *  -m: month</span></span><br><span class="line"><span class="comment"> *  -d: day</span></span><br><span class="line"><span class="comment"> *  -H: hour</span></span><br><span class="line"><span class="comment"> *  -M: minute</span></span><br><span class="line"><span class="comment"> *  -S: second</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIMESTRSIZE     1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FMTSTRSIZE      1024      </span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">time_t</span> stamp;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tm</span>;</span></span><br><span class="line">    <span class="type">char</span> timestr[TIMESTRSIZE];</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="type">char</span> fmtstr[FMTSTRSIZE];</span><br><span class="line">    FILE *fp = <span class="built_in">stdout</span>;</span><br><span class="line"></span><br><span class="line">    fmtstr[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    time(&amp;stamp);</span><br><span class="line">    tm = localtime(&amp;stamp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        c = getopt(argc,argv,<span class="string">&quot;-H:MSy:md&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(c &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (c)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * choose the first file:</span></span><br><span class="line"><span class="comment">             * eg: ./mydate -y 4 /tmp/out -m /tmp/out2 -d /tmp/out3</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">if</span>(fp == <span class="built_in">stdout</span>)  </span><br><span class="line">            &#123;</span><br><span class="line">                fp = fopen(argv[optind<span class="number">-1</span>],<span class="string">&quot;w&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    perror(<span class="string">&quot;fopen()&quot;</span>);</span><br><span class="line">                    fp = <span class="built_in">stdout</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;H&#x27;</span>:</span><br><span class="line">            <span class="comment">// strncat(fmtstr,&quot;%H &quot;,FMTSTRSIZE);</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(optarg,<span class="string">&quot;12&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%I(%P) &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(optarg,<span class="string">&quot;24&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%H &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">&quot;Invalid argument of &#x27;-H&#x27;\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">            <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%M &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">            <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%S &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            <span class="comment">// strncat(fmtstr,&quot;%y &quot;,FMTSTRSIZE);</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(optarg,<span class="string">&quot;2&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%y &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(optarg,<span class="string">&quot;4&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%Y &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">&quot;Invalid argument of &#x27;-y&#x27;\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">            <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%m &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">            <span class="built_in">strncat</span>(fmtstr,<span class="string">&quot;%d &quot;</span>,FMTSTRSIZE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    strftime(timestr,TIMESTRSIZE,fmtstr,tm);</span><br><span class="line">    <span class="built_in">fprintf</span>(fp,<span class="string">&quot;%s\n&quot;</span>,timestr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(fp != <span class="built_in">stdout</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        fclose(fp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：实现mydate.c程序时，可以按照如下顺序：mdMS，Hy，非选项的传参，文件的操作。</p>
<h3 id="getopt-long-3"><a href="#getopt-long-3" class="headerlink" title="getopt_long(3)"></a>getopt_long(3)</h3><p>getopt_long() 函数与getopt() 函数类似，也是用于解析命令行参数的函数。但相较于getopt()，它支持更复杂的选项处理，包括长选项（长格式的命令行选项，例如 <code>--help</code>）以及更多的自定义配置。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;getopt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getopt_long</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *<span class="type">const</span> argv[],</span></span><br><span class="line"><span class="params">                <span class="type">const</span> <span class="type">char</span> *optstring,</span></span><br><span class="line"><span class="params">                <span class="type">const</span> <span class="keyword">struct</span> option *longopts, <span class="type">int</span> *longindex)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>argc</code>：命令行参数个数，包括程序名本身。</li>
<li><code>argv</code>：指向命令行参数字符串数组的指针，其中包括程序名和各个参数。</li>
<li><code>optstring</code>：类似于getopt() 的选项字符串，表示程序所支持的短选项。</li>
<li><code>longopts</code>：一个指向<code>struct option</code>类型的数组，表示程序所支持的长选项。数组中的每个元素都是一个 option 结构体，其定义如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">option</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *name;  <span class="comment">// 长选项的名称</span></span><br><span class="line">    <span class="type">int</span> has_arg;       <span class="comment">// 指定是否需要参数，可以是 no_argument (0)，required_argument (1)，或 optional_argument (2)</span></span><br><span class="line">    <span class="type">int</span> *flag;         <span class="comment">// 用于决定如何返回结果，如果 flag 是 NULL，getopt_long() 返回的是 val 的值，否则返回 0，并将 flag 指向的变量设置为 val</span></span><br><span class="line">    <span class="type">int</span> val;           <span class="comment">// 如果选项被找到，val 是返回的值，或者加载到 flag 指向的变量中</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>longindex</code>：用于返回当前长选项在<code>longopts</code>数组中的索引，通常可设置为 NULL。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>如果找到合法选项，返回选项的短选项字符或者长选项的<code>val</code>字段。</li>
<li>如果所有命令行选项都解析完毕，则返回-1。</li>
<li>如果遇到非法选项字符或者无法匹配的长选项，则返回<code>?</code>。</li>
</ul>
<p>注意事项：</p>
<ol>
<li>在选项数组（option array）中，最后一个元素必须全部填充为零，表示数组的结束。</li>
</ol>
</div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "http://example.com/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/";
            const title         = "「解析命令行参数」";
            const excerpt       = `主要介绍解析命令行参数的两个函数：getopt()，getopt_long()`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/system-programming/" rel="tag">system programming</a>
                </div>
                <div class="pull-date">
                    <time datetime="2023-08-21T10:18:02.156Z" itemprop="dateModified">最后编辑：2023-08-21</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 第五章：线程相关函数" href="/2023/08/16/Chapter5_线程重要函数/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 钩子函数|进程的终止方式" href="/2023/08/18/钩子函数/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.png" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                16
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                5
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                7
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#man%E6%89%8B%E5%86%8C"><span class="toc-text">man手册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getopt-3"><span class="toc-text">getopt(3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getopt-long-3"><span class="toc-text">getopt_long(3)</span></a></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E3%80%8A%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%EF%BC%88C%E8%AF%AD%E8%A8%80%E7%89%88%EF%BC%89%E3%80%8B/">《系统编程实践（C语言版）》</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/">二进制</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E6%BF%80%E6%B4%BB/">软件激活</a><span class="category-list-count">1</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/BurpSuite/" style="font-size: 0.6em;">BurpSuite</a> <a href="/tags/DynELF/" style="font-size: 0.6em;">DynELF</a> <a href="/tags/ELF/" style="font-size: 0.6em;">ELF</a> <a href="/tags/SSH%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" style="font-size: 0.6em;">SSH免密登录</a> <a href="/tags/system-programming/" style="font-size: 0.8em;">system programming</a> <a href="/tags/%E5%85%B1%E4%BA%AB%E5%BA%93/" style="font-size: 0.6em;">共享库</a> <a href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5/" style="font-size: 0.6em;">动态链接</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2023/08/25/Chapter6_%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"><i class="fa  fa-book"></i> 第六章：进程间通信</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/22/Chapter3_%E8%BF%9B%E7%A8%8B/"><i class="fa  fa-book"></i> 第三章：进程</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/18/%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0/"><i class="fa  fa-book"></i> 钩子函数|进程的终止方式</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/"><i class="fa  fa-book"></i> 解析命令行参数</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/16/Chapter5_%E7%BA%BF%E7%A8%8B%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0/"><i class="fa  fa-book"></i> 第五章：线程相关函数</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <!-- Keep for compatibility -->
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <!-- New links -->
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 江城子同学 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by flyingfox.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
                    <div class="box theme-box" id="snow-switch">
                        <span class="fa fa-snowflake-o"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>

    <div>
        <canvas id="snow"></canvas>
        <script async src="/js/snow.min.js"></script>
    </div>


    <script async src="/js/candy.min.js"></script>



    <script defer src="/vendors/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="/vendors/meting@2.0.1/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="3204190542"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>