<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  
  
  <title>第一章：输入输出 | 江城子同学</title>
  
  <meta name="author" content="flyingfox" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="system programming" />
  
  <meta name="description" content="主要讲解I&#x2F;O相关函数，文件描述符。">
<meta property="og:type" content="article">
<meta property="og:title" content="第一章：输入输出">
<meta property="og:url" content="http://example.com/2023/07/27/Chapter1_IO/index.html">
<meta property="og:site_name" content="江城子同学">
<meta property="og:description" content="主要讲解I&#x2F;O相关函数，文件描述符。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/07/27/Chapter1_IO/images/thumbnail/io.png">
<meta property="article:published_time" content="2023-07-27T10:36:59.000Z">
<meta property="article:modified_time" content="2023-08-15T06:59:37.313Z">
<meta property="article:author" content="flyingfox">
<meta property="article:tag" content="system programming">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/07/27/Chapter1_IO/images/thumbnail/io.png">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
    <link rel="stylesheet" href="/vendors/aplayer@1.10.1/dist/APlayer.min.css"></script>
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
    
  </style>
  
<meta name="generator" content="Hexo 6.3.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                    
                                        
                                            <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                        
                                    
                                        
                                            <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                        
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">江城子同学</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>江城子同学</h2> <br />
                        <span>十年饮冰，难凉热血</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/27/Chapter1_IO/">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">第一章：输入输出</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2023-07-27T10:36:59.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2023-07-27</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">flyingfox</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~7.22K
                        
                        字
                    </li>
                
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1692082777313"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
                <div class="kratos-post-inner-toc toc-div-class" >
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86I-O"><span class="toc-number">1.</span> <span class="toc-text">标准I&#x2F;O</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fopen-3"><span class="toc-number">1.1.</span> <span class="toc-text">fopen(3)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6I-O"><span class="toc-number">2.</span> <span class="toc-text">文件I&#x2F;O</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">2.1.</span> <span class="toc-text">文件描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open-2"><span class="toc-number">2.2.</span> <span class="toc-text">open(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#close-2"><span class="toc-number">2.3.</span> <span class="toc-text">close(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-2"><span class="toc-number">2.4.</span> <span class="toc-text">read(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#write-2"><span class="toc-number">2.5.</span> <span class="toc-text">write(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lseek-2"><span class="toc-number">2.6.</span> <span class="toc-text">lseek(2)</span></a></li></ol></li></ol>
                </div>
            
            <hr />
            <div itemprop="articleBody"><p>主要讲解I&#x2F;O相关函数，文件描述符。</p>
<span id="more"></span>

<p>注：标题中显示的函数数字表示该函数在man手册中所在章节（第2章的是系统调用函数，第3章的是标准函数）</p>
<p><strong>I&#x2F;O是一切实现的基础。</strong></p>
<h2 id="标准I-O"><a href="#标准I-O" class="headerlink" title="标准I&#x2F;O"></a>标准I&#x2F;O</h2><h3 id="fopen-3"><a href="#fopen-3" class="headerlink" title="fopen(3)"></a>fopen(3)</h3><p>fopen()函数用于打开一个文件，并返回一个指向FILE结构体的指针，该结构体包含了关于文件的信息，如文件流、读写位置等，以供后续使用高级文件流进行文件的读写操作。它可以用于创建新文件、打开已存在的文件，并指定文件的打开模式（只读、只写、追加等）。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">FILE *<span class="title function_">fopen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">const</span> <span class="type">char</span> *mode)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>path</code>：要打开的文件路径的字符串，可以是绝对路径或相对路径。</li>
<li><code>mode</code>：一个字符串，用来指定文件打开的模式和选项。模式字符串中的字符代表不同的选项，例如”r”表示只读模式，”w”表示只写模式，”a”表示追加模式等。详细的模式选项见下面的说明。</li>
</ul>
<p>文件打开模式说明：</p>
<ul>
<li>“<strong>r</strong>“: 只读模式。文件必须存在，否则打开失败。</li>
<li>“<strong>r+</strong>“: 读写模式。文件必须存在，可以读取和写入。</li>
<li>“<strong>w</strong>“: 只写模式。如果文件不存在，则创建新文件；如果文件存在，则清空文件内容。</li>
<li>“<strong>w+</strong>“: 读写模式。如果文件不存在，则创建新文件；如果文件存在，则清空文件内容，可以读取和写入。</li>
<li>“<strong>a</strong>“: 追加模式。如果文件不存在，则创建新文件；如果文件存在，则在文件末尾追加写入。</li>
<li>“<strong>a+</strong>“: 读写模式。如果文件不存在，则创建新文件；如果文件存在，则在文件末尾追加读写。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>执行成功时，返回一个指向FILE结构体的指针，指向打开的文件流。如果打开或创建文件成功，该指针非空；</li>
<li>如果打开或创建文件失败，返回值为NULL，表示文件打开失败或者权限不足。</li>
</ul>
<blockquote>
<p><strong>The argument mode points to a string beginning with one of the following sequences</strong> (possibly followed by additional characters, as described below):</p>
<p>​       r:  Open text file for reading.  The stream is positioned at the beginning of the file.</p>
<p>​       r+:  Open for reading and writing.  The stream is positioned at the beginning of the file.</p>
<p>​       w:  Truncate file to zero length or create text file for writing.  The stream is positioned at the beginning of the file.</p>
<p>​       w+:  Open for reading and writing.  The file is created if it does not exist, otherwise it is truncated.  The stream is positioned at the beginning of the file.</p>
<p>​       a:  Open for appending (writing at end of file).  The file is created if it does not exist.  The stream is positioned at the end of the file.</p>
<p>​       a+:  Open  for  reading  and appending (writing at end of file).  The file is created if it does not exist.  The initial file position for reading is at the beginning of the file, but output is always appended to the end of the file.</p>
</blockquote>
<p>beginning of the file：文件打开后第一个有效字节的位置；</p>
<p>end of file：文件的最后一个有效字节的下一个位置；</p>
<p>当前位置：读和写都发生在文件的当前位置；</p>
<p>注意事项：</p>
<p>（1）fp &#x3D; fopen(“tmp”,”readwrite”)语句中的mode变量效果等价于”r”，“r+write”等价于”r+”。</p>
<p>（2）在调用fopen()函数时，需要确保提供合适的文件打开模式，以防止意外地覆盖或清空原有文件内容。</p>
<p>（3）对于fopen()函数返回的文件指针，在进行文件读写操作后，需要调用fclose()函数来关闭文件流，释放相关资源。</p>
<h2 id="文件I-O"><a href="#文件I-O" class="headerlink" title="文件I&#x2F;O"></a>文件I&#x2F;O</h2><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>通俗点说，文件描述符就是数组下标，一个整型数。</p>
<p><img src="https://flyingfox092-1300215590.cos.ap-shanghai.myqcloud.com/system-programming/sp1-1.png"></p>
<p>每个文件都有一个唯一标识inode（就像每个人都有个唯一的身份证号），如果使用open()打开一个文件，会获得一个相关联的结构体，这个结构体中包含了操作该文件时所有必要的信息，就像fopen()打开一个文件会返回一个FILE指针，通过这个指针来进行文件的读写，前面获得的结构体也会有个指针，该指针存放在数组中，交给用户的是存放这个指针的数组的下标，即一个整型数。<strong>通过这个整型数找到一个指针，通过这个指针找到一个结构体，通过这个结构体可以操作一个文件</strong>。</p>
<p>这个数组有多大？一个进程最多能打开多少个文件，通过ulimit来查看。</p>
<p><img src="https://flyingfox092-1300215590.cos.ap-shanghai.myqcloud.com/system-programming/sp1-2.png"></p>
<p>一说到stream，其中三个标准的是stdin，stdout，stderr，一说到fd，其中三个标准的是0,1,2。</p>
<p>文件描述符优先使用当前可用范围内最小的。</p>
<p><img src="https://flyingfox092-1300215590.cos.ap-shanghai.myqcloud.com/system-programming/sp1-3.png"></p>
<p>如果把下标4的内容复制一份放到下标为6的位置，则下标4和下标6对应的两个指针关联的是同一个结构体，如果close(4)，那6那部分还能用吗？如果关联的结构体释放掉了，那下标6的指针就会成为一个野指针。每个结构体当中应该有个计数器，来反映当前结构体被几个指针引用了，如果这个计数器的值不是0，就不free()掉。</p>
<h3 id="open-2"><a href="#open-2" class="headerlink" title="open(2)"></a>open(2)</h3><p>open()函数用于打开一个已存在的文件或者创建一个新文件，函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>pathname</code>：要打开的文件所在路径的字符串，可以是绝对路径或相对路径。</li>
<li><code>flags</code>：位图，用来指定文件打开的模式和选项，必须包含以下中的一个：O_RDONLY，O_WRONLY，O_RDWR。如果flags中有O_CREAT，用三参形式的open()，没有的话，就用两参形式的open()。</li>
<li><code>mode</code>：创建新文件时，该参数用来指定新文件的权限，它是一个八进制数，通常使用 0644 这样的形式。</li>
</ul>
<p>返回值：</p>
<p>返回一个整型的文件描述符（File Descriptor），代表打开或创建的文件。</p>
<ul>
<li>如果打开或创建文件成功，将返回非负整数的文件描述符；</li>
<li>如果出现错误，返回值为-1，并设置全局变量errno来表示具体的错误类型。</li>
</ul>
<p>注意事项：</p>
<ol>
<li>打开文件成功后，务必在不需要使用文件描述符时及时关闭文件，以防止文件描述符泄漏。</li>
<li>使用open()函数创建文件时，应该在flags中使用O_CREAT选项，并且提供合适的文件权限模式mode，以确保创建的文件具有正确的权限。</li>
<li>在对文件进行读写操作时，建议进行错误检查和适当的错误处理，以应对可能发生的错误情况。</li>
</ol>
<h3 id="close-2"><a href="#close-2" class="headerlink" title="close(2)"></a>close(2)</h3><p>close()函数用于关闭已打开的文件，释放与之关联的系统资源。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">close</span><span class="params">(<span class="type">int</span> fd)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>fd</code>：表示要关闭的文件描述符。它是open()，socket()等函数返回的一个整型值。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>执行成功时，返回值为0；</li>
<li>如果出现错误，返回值为-1，并设置全局变量errno来表示具体的错误类型。</li>
</ul>
<h3 id="read-2"><a href="#read-2" class="headerlink" title="read(2)"></a>read(2)</h3><p>read()函数用于从已打开的文件描述符中读取数据，并将读取的内容存储到指定的缓冲区中。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>fd</code>：表示要读取的文件描述符（File Descriptor）。</li>
<li><code>buf</code>：是一个指向用于存储读取数据的缓冲区的指针。读取的数据将被存储到这个缓冲区中。</li>
<li><code>count</code>：表示要读取的字节数，即希望从文件中读取的数据量。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>read()函数执行成功时，返回实际读取的字节数；（这个值可能小于等于count，因为在某些情况下，可能读取到文件末尾或者发生了错误）</li>
<li>若已到达文件末尾，返回值为0；</li>
<li>若出现错误，返回值为-1，并设置全局变量errno来表示具体的错误类型。</li>
</ul>
<blockquote>
<p><em>On success, the number of bytes read is returned (zero indicates end of file),  and  the  file position  is  advanced  by this number.  It is not an error if this number is smaller than the number of bytes requested; this may happen for example because fewer bytes are actually available  right  now (maybe because we were close to end-of-file, or because we are reading from a pipe, or from a terminal), or because read() was interrupted by a signal.  See also NOTES.</em><br><em>On error, -1 is returned, and errno is set appropriately.  In this case, it is  left  unspecified whether the file position (if any) changes.</em><br><em>返回值：读到的字节数；若已到达文件尾端，返回0；若出错，返回-1。</em></p>
</blockquote>
<p>注意事项：</p>
<ol>
<li>read()函数是一个阻塞调用，如果没有数据可读，程序会阻塞在该函数处等待数据到达或者出现其他特定的事件。</li>
<li>使用read()函数读取文本文件时，注意文本文件中可能含有换行符\n，所以在打印输出时可能会换行。如果不需要换行，可以在输出中去掉换行符。</li>
</ol>
<h3 id="write-2"><a href="#write-2" class="headerlink" title="write(2)"></a>write(2)</h3><p>write()函数用于将数据写入已打开的文件描述符中，将指定的缓冲区数据写入到文件中。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>fd</code>：表示要写入的文件描述符。</li>
<li><code>buf</code>：是一个指向要写入数据的缓冲区的指针。这个缓冲区中的数据将被写入到文件中。</li>
<li><code>count</code>：表示要写入的字节数，即缓冲区中要写入到文件的数据量。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>write()函数执行成功时，返回实际写入的字节数。这个值通常等于count，除非写入遇到错误或遇到了输出限制。</li>
<li>若返回值为-1，表示写入发生错误，并设置全局变量errno来表示具体的错误类型。</li>
</ul>
<blockquote>
<p><em>On success, the number of bytes written is returned (zero indicates nothing was written).  <strong>It is  not an error if this number is smaller than the number of bytes requested; this may happen for example because the disk device was filled.</strong>  See also NOTES.</em><br><em>On error, -1 is returned, and errno is set appropriately.</em><br><em>If count is zero and fd refers to a regular file, then write() may return a failure status  if one  of  the  errors  below is detected.  If no errors are detected, or error detection is not performed, 0 will be returned without causing any other effect.   If  count  is  zero  and  fd refers to a file other than a regular file, the results are not specified.</em><br><em>返回值：若成功，返回已写的字节数；若出错，返回-1。</em></p>
</blockquote>
<p>注意事项：</p>
<ol>
<li>write()函数是一个阻塞调用，如果写入操作被阻塞（例如写入缓冲区已满），程序会等待直到能够继续写入或出现其他特定的事件。</li>
<li>当写入数据到文件时，注意文件权限和文件打开模式，确保文件能够正确写入。如果文件权限不足或文件未正确打开，写入操作可能会失败。</li>
</ol>
<h3 id="lseek-2"><a href="#lseek-2" class="headerlink" title="lseek(2)"></a>lseek(2)</h3><p>lseek()函数用于设置文件的偏移量。程序可以在文件中定位到指定的位置，从而实现对文件的随机访问。函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">off_t</span> <span class="title function_">lseek</span><span class="params">(<span class="type">int</span> fd, <span class="type">off_t</span> offset, <span class="type">int</span> whence)</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>fd</code>：表示要进行偏移设置的文件描述符。</li>
<li><code>offset</code>：表示要设置的偏移量。它是一个off_t类型的值，可以是正数、负数或零，用于指定相对于whence参数所指定位置的偏移量。</li>
<li><code>whence</code>：表示偏移量的参考位置，即偏移量的计算方式。它可以取三个值：<ul>
<li><strong>SEEK_SET</strong>：从文件起始位置开始计算偏移量。此时，offset表示从文件起始位置开始的偏移量。</li>
<li><strong>SEEK_CUR</strong>：从当前文件读写位置开始计算偏移量。此时，offset表示相对于当前位置的偏移量。</li>
<li><strong>SEEK_END</strong>：从文件末尾开始计算偏移量。此时，offset表示相对于文件末尾的偏移量。</li>
</ul>
</li>
</ul>
<p>函数返回值：</p>
<p>函数执行成功时，返回设置后的文件偏移量。</p>
<ul>
<li>若设置成功，返回新的文件偏移量，该值通常等于offset参数；</li>
<li>若出现错误，返回值为-1，并设置全局变量errno来表示具体的错误类型。</li>
</ul>
<blockquote>
<p><em>The lseek() function allows the file offset to be set beyond the end of  the  file  (but  this does  not  change  the  size of the file).  If data is later written at this point, subsequent reads of the data in the gap (a “hole”) return null bytes (‘\0’) until data is actually  written into the gap.</em></p>
<p><em>Upon successful completion, lseek() returns the resulting offset location as measured in bytes from the beginning of the file.  On error, the value (off_t) -1 is returned and errno  is  set to indicate the error.</em><br><em>返回值：若成功，返回新的文件偏移量；若出错，返回-1。</em></p>
</blockquote>
<p>注：off_t类型用于指示文件的偏移量，常就是long类型，其默认为一个32位的整数，在gcc编译中会被编译为long int类型，在64位的Linux系统中则会被编译为long long int，这是一个64位的整数，其定义在unistd.h头文件中可以查看。</p>
<p>注意事项：</p>
<p>对于不支持偏移设置的设备或文件（如终端、管道等），lseek()函数可能不起作用，返回值为-1，并设置errno为<strong>ESPIPE</strong>错误。</p>
</div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "http://example.com/2023/07/27/Chapter1_IO/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "http://example.com/2023/07/27/Chapter1_IO/";
            const title         = "「第一章：输入输出」";
            const excerpt       = `主要讲解I&#x2F;O相关函数，文件描述符。`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/system-programming/" rel="tag">system programming</a>
                </div>
                <div class="pull-date">
                    <time datetime="2023-08-15T06:59:37.313Z" itemprop="dateModified">最后编辑：2023-08-15</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 安装破解新版BurpSuite" href="/2021/07/19/安装破解新版BurpSuite/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 第五章：线程同步机制" href="/2023/08/15/Chapter5_线程同步机制/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.png" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                13
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                5
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                7
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86I-O"><span class="toc-text">标准I&#x2F;O</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fopen-3"><span class="toc-text">fopen(3)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6I-O"><span class="toc-text">文件I&#x2F;O</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">文件描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open-2"><span class="toc-text">open(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#close-2"><span class="toc-text">close(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-2"><span class="toc-text">read(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#write-2"><span class="toc-text">write(2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lseek-2"><span class="toc-text">lseek(2)</span></a></li></ol></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E3%80%8A%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%EF%BC%88C%E8%AF%AD%E8%A8%80%E7%89%88%EF%BC%89%E3%80%8B/">《系统编程实践（C语言版）》</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/">二进制</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E6%BF%80%E6%B4%BB/">软件激活</a><span class="category-list-count">1</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/BurpSuite/" style="font-size: 0.6em;">BurpSuite</a> <a href="/tags/DynELF/" style="font-size: 0.6em;">DynELF</a> <a href="/tags/ELF/" style="font-size: 0.6em;">ELF</a> <a href="/tags/SSH%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" style="font-size: 0.6em;">SSH免密登录</a> <a href="/tags/system-programming/" style="font-size: 0.8em;">system programming</a> <a href="/tags/%E5%85%B1%E4%BA%AB%E5%BA%93/" style="font-size: 0.6em;">共享库</a> <a href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5/" style="font-size: 0.6em;">动态链接</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2023/08/17/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%86%E6%9E%90/"><i class="fa  fa-book"></i> 解析命令行参数</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/16/Chapter5_%E7%BA%BF%E7%A8%8B%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0/"><i class="fa  fa-book"></i> 第五章：线程相关函数</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/08/15/Chapter5_%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6/"><i class="fa  fa-book"></i> 第五章：线程同步机制</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/07/27/Chapter1_IO/"><i class="fa  fa-book"></i> 第一章：输入输出</a>
            
          
        
          
          
            <a class="list-group-item" href="/2021/07/19/%E5%AE%89%E8%A3%85%E7%A0%B4%E8%A7%A3%E6%96%B0%E7%89%88BurpSuite/"><i class="fa  fa-book"></i> 安装破解新版BurpSuite</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <!-- Keep for compatibility -->
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <!-- New links -->
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 江城子同学 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by flyingfox.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
                    <div class="box theme-box" id="snow-switch">
                        <span class="fa fa-snowflake-o"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>

    <div>
        <canvas id="snow"></canvas>
        <script async src="/js/snow.min.js"></script>
    </div>


    <script async src="/js/candy.min.js"></script>



    <script defer src="/vendors/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="/vendors/meting@2.0.1/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="3204190542"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>